<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🌸 تابان جامه | پارچه‌های لوکس برای هر سلیقه</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Vazirmatn font import */
    @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700&display=swap');

    body {
      font-family: 'Vazirmatn', sans-serif;
      background-color: #f8fafc;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    /* Dark Mode Styles */
    body.dark-mode {
      background-color: #1a202c; /* Dark background */
      color: #e2e8f0; /* Light text */
    }

    body.dark-mode .bg-white {
      background-color: #2d3748; /* Darker shade for cards, header, footer */
      color: #e2e8f0;
    }

    body.dark-mode .bg-gray-50 {
      background-color: #4a5568; /* Darker shade for category/info items background */
      color: #e2e8f0;
    }

    body.dark-mode .bg-gray-100 {
      background-color: #2c313a; /* Darker shade for smaller gray elements */
      color: #cbd5e0;
    }

    body.dark-mode .text-gray-800 {
      color: #e2e8f0;
    }

    body.dark-mode .text-gray-700 {
      color: #cbd5e0;
    }

    body.dark-mode .text-gray-600 {
      color: #a0aec0;
    }

    body.dark-mode .text-gray-500 {
      color: #718096;
    }

    body.dark-mode .text-gray-400 {
      color: #a0aec0;
    }

    body.dark-mode .border-gray-300 {
      border-color: #4a5568;
    }

    body.dark-mode .active-category {
      background-color: #1a4d48; /* Darker teal for active category */
      border-right-color: #0F766E; /* Keep primary teal for border */
    }
    
    body.dark-mode .notification-banner {
      background-color: #0d5c56; /* Darker teal for notification */
    }
    
    body.dark-mode .special-offer-card {
      background-color: #2d3748;
      border-color: #4a5568;
    }

    body.dark-mode .search-input {
      background-color: #4a5568;
      color: #e2e8f0;
      border-color: #718096;
    }
    body.dark-mode .search-input::placeholder {
      color: #a0aec0;
    }
    body.dark-mode .search-input:focus {
      box-shadow: 0 0 0 2px #0F766E; /* Focus outline matches teal */
    }

    /* Custom styles for transitions and active states */
    .category-item {
      transition: all 0.2s ease;
      border-bottom: 1px solid #e5e7eb;
    }

    .category-item:hover {
      background-color: #f3f4f6;
    }
    body.dark-mode .category-item:hover {
      background-color: #414b5d;
    }

    .fabric-item {
      transition: all 0.2s ease;
      border-bottom: 1px solid #e5e7eb;
    }

    .fabric-item:hover {
      background-color: #f3f4f6;
    }
    body.dark-mode .fabric-item:hover {
      background-color: #414b5d;
    }

    .notification-banner {
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .search-input:focus {
      outline: none;
      box-shadow: 0 0 0 2px #d1fae5;
    }

    .active-category {
      background-color: #F0FDFA; /* Light teal background for active category (teal-50) */
      border-right: 4px solid #0F766E; /* Border on the right for RTL, matching teal-700 */
    }

    .special-offer-card {
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
    }

    .special-offer-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    body.dark-mode .special-offer-card:hover {
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
    }

    /* Unified style for subcategory-like items */
    .info-item { /* New class for features and width options */
      transition: all 0.2s ease;
      background-color: #f8fafc; /* Lighter gray for individual items */
      padding: 0.5rem 0.75rem; /* py-2 px-3 */
      border-radius: 0.375rem; /* rounded-lg */
      font-size: 0.875rem; /* text-sm */
      display: flex;
      align-items: center;
    }

    .info-item:hover {
      background-color: #f0fdf4; /* Slightly darker on hover */
    }
    body.dark-mode .info-item {
      background-color: #4a5568; /* Darker gray for individual items in dark mode */
    }
    body.dark-mode .info-item:hover {
      background-color: #5d687b; /* Even darker on hover in dark mode */
    }

    .fabric-detail {
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Custom styles for horizontal scroll on mobile for special offers */
    @media (max-width: 767px) {
      .special-offers-scroll {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch; /* Enable smooth scrolling on iOS */
        scroll-snap-type: x mandatory; /* Snap to cards */
        display: flex; /* Ensure flexbox for horizontal layout */
        padding-bottom: 1rem; /* Add some padding for scrollbar if it appears */
        margin-left: -1rem; /* Negative margin to align first card to edge */
        padding-right: 1rem; /* Padding to show a peek of the next card */
      }
      .special-offer-card-wrapper {
        flex: 0 0 auto; /* Prevent cards from shrinking */
        width: 80%; /* Adjust card width for mobile view, showing a peek of next */
        scroll-snap-align: start; /* Snap cards to start */
        margin-left: 1rem; /* Spacing between cards and from left edge */
      }
      .special-offers-scroll > *:first-child {
        margin-left: 1rem; /* Ensure first card aligns properly with content */
      }
      /* Header adjustments for mobile */
      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        flex-wrap: nowrap; /* Prevent wrapping of main header elements */
      }
      .header-logo {
        width: 40px; /* Adjusted for mobile */
        height: 40px; /* Adjusted for mobile */
        margin-left: 8px; /* Adjust margin for spacing */
      }
      .header-title {
        font-size: 1.125rem; /* text-xl */
        line-height: 1.75rem; /* leading-7 */
        white-space: nowrap; /* Keep title on one line */
      }
      .header-button {
        padding-left: 0.5rem; /* px-2 */
        padding-right: 0.5rem; /* px-2 */
        font-size: 0.75rem; /* text-xs */
      }
    }
    /* Adjustments for larger screens (md and up) to revert mobile styles */
    @media (min-width: 768px) {
      .header-logo {
        width: 64px; /* w-16 */
        height: 64px; /* h-16 */
        margin-left: 8px; /* ml-2 */
      }
      .header-title {
        font-size: 1.25rem; /* text-xl */
      }
      .header-button {
        padding-left: 1rem; /* px-4 */
        padding-right: 1rem; /* px-4 */
        font-size: 0.875rem; /* text-sm */
      }
    }
  </style>
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Enhanced Fabric Data with more categories and items
    const fabricData = {
      categories: [
        {
          name: "نخی و طبیعی",
          fabrics: [
            {
              name: "پارچه نخی (پنبه‌ای)",
              subcategories: ["پنبه ساده 100%", "پنبه ساده مخلوط", "پنبه ساده ضخیم", "پنبه ساده نازک"],
              colors: ["سفید", "کرم", "آبی روشن", "صورتی"],
              price: "متر 45,000 تومان",
              discount: "10% تخفیف برای خرید بالای 10 متر",
              images: [
                "https://placehold.co/400x300/E0F2F7/000000?text=پنبه+ساده+1",
                "https://placehold.co/400x300/E0F2F7/000000?text=پنبه+ساده+2",
                "https://placehold.co/400x300/E0F2F7/000000?text=پنبه+ساده+3"
              ],
              features: ["ضد حساسیت", "تنفس‌پذیر", "نرم و لطیف", "مناسب تابستان"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }, { width: 110, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه کتان", "پارچه لینن"]
            },
            {
              name: "پارچه کتان",
              subcategories: ["کتان خالص", "کتان مخلوط", "کتان طرح‌دار", "کتان ساده"],
              colors: ["بژ", "سفید", "طوسی", "سبز روشن"],
              price: "متر 65,000 تومان",
              discount: "15% تخفیف امروز",
              images: [
                "https://placehold.co/400x300/F0FDF4/000000?text=پارچه+کتان+1",
                "https://placehold.co/400x300/F0FDF4/000000?text=پارچه+کتان+2"
              ],
              features: ["بادوام", "خنک", "مقاوم در برابر چروک شدن", "مناسب لباس روزمره"],
              widthOptions: [{ width: 140, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه نخی (پنبه‌ای)", "پارچه جین"]
            },
            {
              name: "پارچه لینن",
              subcategories: ["لینن ساده", "لینن طرح‌دار", "لینن مخلوط"],
              colors: ["طبیعی", "سفید", "آبی کم‌رنگ", "سبز"],
              price: "متر 70,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/E0F2F7/000000?text=پارچه+لینن+1",
                "https://placehold.co/400x300/E0F2F7/000000?text=پارچه+لینن+2"
              ],
              features: ["لوکس", "خنک", "بافت خاص", "مناسب پیراهن و لباس تابستانی"],
              widthOptions: [{ width: 130, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه نخی (پنبه‌ای)", "پارچه حریر"]
            },
            {
              name: "پارچه کتان خامه‌دوزی",
              subcategories: ["کتان خامه‌دوزی گلدار", "کتان خامه‌دوزی هندسی"],
              colors: ["سفید", "کرم", "صورتی پاستلی"],
              price: "متر 80,000 تومان",
              discount: "5% تخفیف",
              images: [
                "https://placehold.co/400x300/F0FDF4/000000?text=کتان+خامه\u200cدوزی+1"
              ],
              features: ["طرح‌های سنتی", "نرم و لطیف", "مناسب لباس مجلسی", "ظاهر خاص"],
              widthOptions: [{ width: 110, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه گیپور", "پارچه دانتل"]
            }
          ]
        },
        {
          name: "ابریشمی و براق",
          fabrics: [
            {
              name: "پارچه ابریشمی",
              subcategories: ["ابریشم خالص", "ابریشم مخلوط", "ابریشم ضخیم", "ابریشم نازک"],
              colors: ["مرواریدی", "طلایی", "نقره‌ای", "صورتی"],
              price: "متر 120,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/FFFBEB/000000?text=پارچه+ابریشمی+1",
                "https://placehold.co/400x300/FFFBEB/000000?text=پارچه+ابریشمی+2"
              ],
              features: ["لطافت بی‌نظیر", "درخشش طبیعی", "لوکس", "مناسب لباس شب"],
              widthOptions: [{ width: 110, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه ساتن", "پارچه حریر"]
            },
            {
              name: "پارچه ساتن",
              subcategories: ["ساتن خالص", "ساتن مخلوط", "ساتن طرح‌دار", "ساتن ساده"],
              colors: ["مشکی", "آبی دریایی", "بنفش", "قرمز"],
              price: "متر 85,000 تومان",
              discount: "5% تخفیف برای خرید عمده",
              images: [
                "https://placehold.co/400x300/FEF2F2/000000?text=پارچه+ساتن+1",
                "https://placehold.co/400x300/FEF2F2/000000?text=پارچه+ساتن+2"
              ],
              features: ["سطح براق", "افتادگی زیبا", "مناسب لباس مجلسی", "لوکس"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه ابریشمی", "پارچه کرپ حریر خالدار"]
            },
            {
              name: "پارچه ساتن سیلک",
              subcategories: ["ساتن سیلک ساده", "ساتن سیلک طرح‌دار"],
              colors: ["طلایی", "نقره‌ای", "شامپاینی"],
              price: "متر 95,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/FFFBEB/000000?text=ساتن+سیلک+1"
              ],
              features: ["نرم و خوش‌دست", "درخشش ابریشم", "مناسب لباس خاص", "سبک"],
              widthOptions: [{ width: 140, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه ابریشمی", "پارچه مجلسی"]
            },
            {
              name: "پارچه حریر",
              subcategories: ["حریر ساده", "حریر طرح‌دار", "حریر شیشه‌ای"],
              colors: ["سفید", "مشکی", "کرم", "آبی آسمانی"],
              price: "متر 60,000 تومان",
              discount: "10% تخفیف",
              images: [
                "https://placehold.co/400x300/FEF2F2/000000?text=پارچه+حریر+1",
                "https://placehold.co/400x300/FEF2F2/000000?text=پارچه+حریر+2"
              ],
              features: ["سبک و شفاف", "افتادگی زیبا", "خنک", "مناسب شال و لباس تابستانی"],
              widthOptions: [{ width: 110, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه لینن", "پارچه کرپ حریر خالدار"]
            },
            {
              name: "پارچه کرپ حریر خالدار",
              subcategories: ["کرپ حریر خالدار ریز", "کرپ حریر خالدار درشت"],
              colors: ["مشکی با خال سفید", "سفید با خال مشکی"],
              price: "متر 75,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/FFFBEB/000000?text=کرپ+حریر+خالدار+1"
              ],
              features: ["لطیف", "طرح جذاب", "مناسب شومیز و دامن", "ظاهر فانتزی"],
              widthOptions: [{ width: 140, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه کرپ", "پارچه حریر"]
            }
          ]
        },
        {
          name: "کرپ",
          fabrics: [
            {
              name: "پارچه کرپ",
              subcategories: ["کرپ پنبه", "کرپ پلی استر", "کرپ ویسکوز", "کرپ مخلوط"],
              colors: ["سفید", "مشکی", "طوسی", "بژ"],
              price: "متر 60,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/F0F9FF/000000?text=پارچه+کرپ+1"
              ],
              features: ["بافت ریز", "مقاوم در برابر چروک", "همه‌کاره", "مناسب مانتو و شلوار"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه کرپ الیزه", "پارچه کرپ مازراتی"]
            },
            {
              name: "پارچه کرپ الیزه",
              subcategories: ["کرپ الیزه ساده", "کرپ الیزه طرح‌دار"],
              colors: ["کرم", "صورتی", "سبز پاستلی"],
              price: "متر 70,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/F3E8FF/000000?text=کرپ+الیزه+1"
              ],
              features: ["نرم و لطیف", "افتادگی زیبا", "مناسب لباس مجلسی", "ظاهر شیک"],
              widthOptions: [{ width: 140, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه کرپ", "پارچه ساتن"]
            },
            {
              name: "پارچه کرپ فراری",
              subcategories: ["کرپ فراری ساده", "کرپ فراری کشی"],
              colors: ["مشکی", "قرمز", "سرمه‌ای"],
              price: "متر 85,000 تومان",
              discount: "10% تخفیف",
              images: [
                "https://placehold.co/400x300/F0F9FF/000000?text=پارچه+فراری+1"
              ],
              features: ["کشسانی بالا", "محکم", "مناسب لباس ورزشی", "انعطاف‌پذیر"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه دورس خارخورده", "پارچه تریکو"]
            },
            {
              name: "پارچه کرپ مازراتی",
              subcategories: ["کرپ مازراتی ساده", "کرپ مازراتی طرح‌دار"],
              colors: ["مشکی", "طوسی", "زرشکی"],
              price: "متر 90,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/F3E8FF/000000?text=کرپ+مازراتی+1"
              ],
              features: ["ضخیم و محکم", "ایستایی خوب", "مقاوم در برابر چروک", "مناسب مانتو و کت"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه کرپ", "پارچه فوتر"]
            },
            {
              name: "پارچه کرپ اکلیلی",
              subcategories: ["کرپ اکلیلی طلایی", "کرپ اکلیلی نقره‌ای", "کرپ اکلیلی رنگی"],
              colors: ["مشکی", "آبی تیره", "سبز تیره", "بنفش"],
              price: "متر 95,000 تومان",
              discount: "20% تخفیف ویژه",
              images: [
                "https://placehold.co/400x300/F0F9FF/000000?text=کرپ+اکلیلی+1"
              ],
              features: ["درخشش خاص", "جذاب", "مناسب لباس شب", "فانتزی"],
              widthOptions: [{ width: 140, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه مجلسی", "پارچه ساتن"]
            },
            {
              name: "پارچه کرپ تایفون",
              subcategories: ["کرپ تایفون ساده", "کرپ تایفون طرح‌دار"],
              colors: ["مشکی", "سفید", "بژ"],
              price: "متر 78,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/F3E8FF/000000?text=کرپ+تایفون+1"
              ],
              features: ["لطیف و سبک", "راحت", "مناسب شومیز", "زیبا"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه حریر", "پارچه ویسکوز"]
            }
          ]
        },
        {
          name: "مخملی و کبریتی",
          fabrics: [
            {
              name: "پارچه مخمل",
              subcategories: ["مخمل پنبه", "مخمل پلی استر", "مخمل مخلوط"],
              colors: ["مشکی", "آبی نفتی", "زرشکی", "سبز تیره"],
              price: "متر 70,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/F9FAFB/000000?text=پارچه+مخمل+1"
              ],
              features: ["نرم و لوکس", "گرم", "مناسب لباس شب", "دلپذیر"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه مخمل کبریتی", "پارچه شنیل"]
            },
            {
              name: "پارچه مخمل کبریتی",
              subcategories: ["مخمل کبریتی ساده", "مخمل کبریتی طرح‌دار", "مخمل کبریتی دو رنگ"],
              colors: ["مشکی", "طوسی", "بورگوندی", "سبز تیره"],
              price: "متر 90,000 تومان",
              discount: "15% تخفیف آخر هفته",
              images: [
                "https://placehold.co/400x300/F0FDF4/000000?text=مخمل+کبریتی+1"
              ],
              features: ["بافت برجسته", "کلاسیک", "مناسب لباس پاییزه", "شیک"],
              widthOptions: [{ width: 140, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه مخمل", "پارچه کبریتی"]
            },
            {
              name: "پارچه کبریتی",
              subcategories: ["کبریتی ریز", "کبریتی درشت", "کبریتی کشی"],
              colors: ["قهوه‌ای", "کرم", "سرمه‌ای"],
              price: "متر 80,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/F9FAFB/000000?text=پارچه+کبریتی+1"
              ],
              features: ["بافت خط‌دار", "مقاوم", "مناسب لباس کژوال", "بادوام"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه جین", "پارچه سوویت"]
            },
            {
              name: "پارچه کبریتی حوله‌ای",
              subcategories: ["کبریتی حوله‌ای ساده", "کبریتی حوله‌ای طرح‌دار"],
              colors: ["سفید", "آبی روشن", "صورتی"],
              price: "متر 85,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/F0FDF4/000000?text=کبریتی+حوله\u200cای+1"
              ],
              features: ["نرم و جذب‌کننده", "راحت", "مناسب لباس راحتی", "لطیف"],
              widthOptions: [{ width: 160, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه نخی (پنبه‌ای)", "پارچه تریکو"]
            },
            {
              name: "پارچه شنیل",
              subcategories: ["شنیل ساده", "شنیل طرح‌دار"],
              colors: ["بژ", "طوسی", "قهوه‌ای تیره"],
              price: "متر 100,000 تومان",
              discount: "5% تخفیف",
              images: [
                "https://placehold.co/400x300/F9FAFB/000000?text=پارچه+شنیل+1"
              ],
              features: ["نرم و پرزدار", "لوکس", "مناسب مبلمان", "گرم"],
              widthOptions: [{ width: 140, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه مخمل", "پارچه پشمی"]
            }
          ]
        },
        {
          name: "پشمی و گرم",
          fabrics: [
            {
              name: "پارچه پشمی",
              subcategories: ["پشم خالص", "پشم مخلوط", "پشم گاباردین"],
              colors: ["طوسی", "قهوه‌ای", "مشکی", "کرم"],
              price: "متر 150,000 تومان",
              discount: "20% تخفیف فصلی",
              images: [
                "https://placehold.co/400x300/F0FDF4/000000?text=پارچه+پشمی+1"
              ],
              features: ["گرم و با کیفیت", "مقاوم", "مناسب لباس زمستانی", "بادوام"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه کشمیر", "پارچه فوتر"]
            },
            {
              name: "پارچه کشمیر",
              subcategories: ["کشمیر ساده", "کشمیر طرح‌دار"],
              colors: ["بژ", "صورتی چرک", "آبی نفتی"],
              price: "متر 180,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/E0F2F7/000000?text=پارچه+کشمیر+1"
              ],
              features: ["بسیار نرم", "لوکس", "لطیف", "مناسب شال و پلیور"],
              widthOptions: [{ width: 140, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه کشمیر ترک", "پارچه پشمی"]
            },
            {
              name: "پارچه کشمیر ترک",
              subcategories: ["کشمیر ترک ساده", "کشمیر ترک طرح‌دار"],
              colors: ["سرمه‌ای", "زرشکی", "سبز تیره"],
              price: "متر 200,000 تومان",
              discount: "10% تخفیف",
              images: [
                "https://placehold.co/400x300/F0FDF4/000000?text=کشمیر+ترک+1"
              ],
              features: ["کیفیت برتر", "طرح‌های متنوع", "مناسب پالتو", "شیک"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه کشمیر", "پارچه تویید"]
            },
            {
              name: "پارچه کشمیر ساده",
              subcategories: ["کشمیر ساده نازک", "کشمیر ساده ضخیم"],
              colors: ["طوسی روشن", "کرم", "مشکی"],
              price: "متر 170,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/E0F2F7/000000?text=پارچه+کشمیر+ساده+1"
              ],
              features: ["بافت یکدست", "نرم", "راحت", "مناسب لباس روزمره"],
              widthOptions: [{ width: 140, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه پشمی", "پارچه فوتر"]
            },
            {
              name: "پارچه تویید",
              subcategories: ["تویید پشمی", "تویید مخلوط", "تویید هریس"],
              colors: ["قهوه‌ای", "طوسی", "سبز زیتونی"],
              price: "متر 160,000 تومان",
              discount: "5% تخفیف",
              images: [
                "https://placehold.co/400x300/F0FDF4/000000?text=پارچه+تویید+1"
              ],
              features: ["ضخیم", "طرح کلاسیک", "مناسب کت و پالتو", "سنتی و شیک"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه پشمی", "پارچه فاستونی"]
            },
            {
              name: "پارچه فوتر",
              subcategories: ["فوتر ساده", "فوتر پشمی", "فوتر کوبیده"],
              colors: ["مشکی", "سرمه‌ای", "شتری"],
              price: "متر 140,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/E0F2F7/000000?text=پارچه+فوتر+1"
              ],
              features: ["فشرده و گرم", "مقاوم در برابر سرما", "مناسب پالتو", "بادوام"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه پشمی", "پارچه کشمیر"]
            }
          ]
        },
        {
          name: "تزیینی و مجلسی",
          fabrics: [
            {
              name: "پارچه گیپور",
              subcategories: ["گیپور ساده", "گیپور برجسته", "گیپور مرواریددوزی"],
              colors: ["سفید", "مشکی", "قرمز", "طلایی"],
              price: "متر 250,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/FFFBEB/000000?text=پارچه+گیپور+1"
              ],
              features: ["طرح‌های ظریف", "برجسته", "زیبا و چشم‌نواز", "مناسب لباس شب و عروسی"],
              widthOptions: [{ width: 110, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه دانتل", "پارچه تور"]
            },
            {
              name: "پارچه دانتل",
              subcategories: ["دانتل ساده", "دانتل طرح‌دار", "دانتل فرانسوی"],
              colors: ["کرم", "نباتی", "نقره‌ای"],
              price: "متر 280,000 تومان",
              discount: "10% تخفیف",
              images: [
                "https://placehold.co/400x300/FEF2F2/000000?text=پارچه+دانتل+1"
              ],
              features: ["بافت ظریف", "توری", "شیک و زنانه", "مناسب لباس مجلسی"],
              widthOptions: [{ width: 110, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه گیپور", "پارچه مجلسی"]
            },
            {
              name: "پارچه تور",
              subcategories: ["تور ساده", "تور کشی", "تور طرح‌دار"],
              colors: ["سفید", "مشکی", "بژ"],
              price: "متر 40,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/FFFBEB/000000?text=پارچه+تور+1"
              ],
              features: ["سبک و شفاف", "لطیف و راحت", "مناسب آستر و تزئینات", "فانتزی"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه حریر", "پارچه گیپور"]
            },
            {
              name: "پارچه مجلسی",
              subcategories: ["مجلسی پولکی", "مجلسی کارشده", "مجلسی حریر"],
              colors: ["نقره‌ای", "طلایی", "آبی کاربنی"],
              price: "متر 300,000 تومان",
              discount: "15% تخفیف",
              images: [
                "https://placehold.co/400x300/FEF2F2/000000?text=پارچه+مجلسی+1"
              ],
              features: ["طرح‌های خاص", "تزئینات زیبا", "خیره‌کننده", "مناسب لباس شب و مراسم"],
              widthOptions: [{ width: 140, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه ساتن سیلک", "پارچه لمزور"]
            },
            {
              name: "پارچه لمزور",
              subcategories: ["لمزور ساده", "لمزور طرح‌دار"],
              colors: ["مشکی", "زرشکی", "سبز تیره"],
              price: "متر 180,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/FFFBEB/000000?text=پارچه+لمزور+1"
              ],
              features: ["بافت خاص و براق", "لوکس", "منحصر به فرد", "مناسب لباس رسمی"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه ژاکارد طرح‌دار", "پارچه ساتن"]
            },
            {
              name: "پارچه کرپ اکلیلی", // Duplicated as per user's request to be in both categories
              subcategories: ["کرپ اکلیلی طلایی", "کرپ اکلیلی نقره‌ای", "کرپ اکلیلی رنگی"],
              colors: ["مشکی", "آبی تیره", "سبز تیره", "بنفش"],
              price: "متر 95,000 تومان",
              discount: "20% تخفیف ویژه",
              images: [
                "https://placehold.co/400x300/F0F9FF/000000?text=کرپ+اکلیلی+مجلسی+1"
              ],
              features: ["درخشش و جذابیت", "ظاهر خیره‌کننده", "مناسب لباس شب", "فانتزی"],
              widthOptions: [{ width: 140, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه مجلسی", "پارچه ساتن"]
            }
          ]
        },
        {
          name: "ژاکارد و طرح‌دار",
          fabrics: [
            {
              name: "پارچه ژاکارد طرح‌دار",
              subcategories: ["ژاکارد گلدار", "ژاکارد هندسی", "ژاکارد داماسک"],
              colors: ["طلایی", "نقره‌ای", "مشکی", "کرم"],
              price: "متر 190,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/E0F2F7/000000?text=ژاکارد+طرح‌دار+1"
              ],
              features: ["طرح‌های بافته شده", "برجسته", "بسیار شیک و خاص", "مناسب مانتو و دکوراسیون"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه فکورا ژاکارد", "پارچه لمزور"]
            },
            {
              name: "پارچه فکورا ژاکارد",
              subcategories: ["فکورا ژاکارد ساده", "فکورا ژاکارد برجسته"],
              colors: ["سبز", "آبی", "صورتی"],
              price: "متر 175,000 تومان",
              discount: "5% تخفیف",
              images: [
                "https://placehold.co/400x300/F0FDF4/000000?text=فکورا+ژاکارد+1"
              ],
              features: ["بافت خاص", "ایستایی خوب", "ظاهری متفاوت", "مناسب لباس رسمی"],
              widthOptions: [{ width: 140, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه ژاکارد طرح‌دار", "پارچه کرپ مازراتی"]
            },
            {
              name: "پارچه ابرو بادی",
              subcategories: ["ابرو بادی ساده", "ابرو بادی طرح‌دار"],
              colors: ["آبی", "بنفش", "سبز"],
              price: "متر 60,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/E0F2F7/000000?text=پارچه+ابرو+بادی+1"
              ],
              features: ["سبک", "خنک", "راحت", "مناسب شومیز و لباس تابستانی"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه حریر", "پارچه ویسکوز"]
            }
          ]
        },
        {
          name: "مصنوعی و ترکیبی",
          fabrics: [
            {
              name: "پارچه پلی‌استر",
              subcategories: ["پلی‌استر ساده", "پلی‌استر کشی", "پلی‌استر طرح‌دار"],
              colors: ["مشکی", "سفید", "طوسی"],
              price: "متر 35,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/F9FAFB/000000?text=پارچه+پلی‌استر+1"
              ],
              features: ["مقاوم و بادوام", "ضد چروک", "مقاوم در برابر آب‌رفتگی", "همه‌کاره"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه ویسکوز", "پارچه ریون"]
            },
            {
              name: "پارچه ویسکوز",
              subcategories: ["ویسکوز ساده", "ویسکوز طرح‌دار", "ویسکوز کشی"],
              colors: ["قرمز", "آبی", "سبز"],
              price: "متر 40,000 تومان",
              discount: "5% تخفیف",
              images: [
                "https://placehold.co/400x300/F0FDF4/000000?text=پارچه+ویسکوز+1"
              ],
              features: ["نرم و لطیف", "تنفس‌پذیر", "خنک", "مناسب لباس روزمره"],
              widthOptions: [{ width: 140, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه نخی (پنبه‌ای)", "پارچه تریکو"]
            },
            {
              name: "پارچه ریون",
              subcategories: ["ریون ساده", "ریون کشی", "ریون طرح‌دار"],
              colors: ["مشکی", "سفید", "بنفش"],
              price: "متر 42,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/F9FAFB/000000?text=پارچه+ریون+1"
              ],
              features: ["نرم و لطیف", "افتادگی زیبا", "خوش‌دست", "مناسب لباس راحتی"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه ویسکوز", "پارچه تریکو"]
            },
            {
              name: "پارچه تریکو",
              subcategories: ["تریکو پنبه", "تریکو پلی‌استر", "تریکو کشی"],
              colors: ["طوسی", "مشکی", "سفید"],
              price: "متر 50,000 تومان",
              discount: "10% تخفیف",
              images: [
                "https://placehold.co/400x300/F0FDF4/000000?text=پارچه+تریکو+1"
              ],
              features: ["کشی و راحت", "انعطاف‌پذیری بالا", "مناسب لباس ورزشی", "بادوام"],
              widthOptions: [{ width: 160, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه دورس خارخورده", "پارچه کرپ فراری"]
            }
          ]
        },
        {
          name: "جین و مقاوم",
          fabrics: [
            {
              name: "پارچه جین",
              subcategories: ["جین ساده", "جین کشی", "جین کاغذی"],
              colors: ["آبی تیره", "آبی روشن", "مشکی"],
              price: "متر 90,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/E0F2F7/000000?text=پارچه+جین+1"
              ],
              features: ["مقاوم و بادوام", "کلاسیک", "مناسب شلوار و کت", "همیشه مد"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه فاستونی", "پارچه سوویت"]
            },
            {
              name: "پارچه فاستونی", // Duplicated as per user's request
              subcategories: ["فاستونی ساده", "فاستونی چهارخانه", "فاستونی راه راه"],
              colors: ["سرمه‌ای", "طوسی ذغالی", "مشکی"],
              price: "متر 130,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/F0FDF4/000000?text=پارچه+فاستونی+1"
              ],
              features: ["محکم و رسمی", "ایستایی عالی", "مناسب کت و شلوار", "شیک"],
              widthOptions: [{ width: 150, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه پشمی", "پارچه تویید"]
            },
            {
              name: "پارچه سوویت",
              subcategories: ["سوویت ساده", "سوویت طرح‌دار"],
              colors: ["خاکی", "سبز ارتشی", "مشکی"],
              price: "متر 110,000 تومان",
              discount: "5% تخفیف",
              images: [
                "https://placehold.co/400x300/E0F2F7/000000?text=پارچه+سوویت+1"
              ],
              features: ["بافت خاص", "مقاوم", "راحت", "مناسب لباس اسپرت"],
              widthOptions: [{ width: 140, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه جین", "پارچه تریکو"]
            }
          ]
        },
        {
          name: "چرمی و مشابه",
          fabrics: [
            {
              name: "پارچه چرم",
              subcategories: ["چرم مصنوعی", "چرم طبیعی", "چرم طرح‌دار"],
              colors: ["مشکی", "قهوه‌ای", "زرشکی"],
              price: "متر 160,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/F9FAFB/000000?text=پارچه+چرم+1"
              ],
              features: ["لوکس", "مقاوم", "شیک و مدرن", "مناسب کت و کیف"],
              widthOptions: [{ width: 140, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه جیر", "پارچه مخمل"]
            },
            {
              name: "پارچه جیر",
              subcategories: ["جیر ساده", "جیر طرح‌دار", "جیر کشی"],
              colors: ["شتری", "طوسی", "سبز تیره"],
              price: "متر 140,000 تومان",
              discount: "10% تخفیف",
              images: [
                "https://placehold.co/400x300/F0FDF4/000000?text=پارچه+جیر+1"
              ],
              features: ["نرم و مخملی", "لطیف", "مناسب لباس پاییزه", "راحت"],
              widthOptions: [{ width: 140, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه چرم", "پارچه مخمل کبریتی"]
            }
          ]
        },
        {
          name: "ورزشی و کشسان",
          fabrics: [
            {
              name: "پارچه دورس خارخورده",
              subcategories: ["دورس خارخورده ساده", "دورس خارخورده ملانژ"],
              colors: ["مشکی", "طوسی", "سرمه‌ای"],
              price: "متر 70,000 تومان",
              discount: null,
              images: [
                "https://placehold.co/400x300/E0F2F7/000000?text=دورس+خارخورده+1"
              ],
              features: ["نرم و گرم", "راحت", "مناسب لباس ورزشی", "کشسان"],
              widthOptions: [{ width: 180, unit: "سانتی‌متر" }],
              relatedFabrics: ["پارچه تریکو", "پارچه کرپ فراری"]
            }
          ]
        }
      ],
      specialOffers: [
        {
          title: "تخفیف ویژه پنبه اکو",
          description: "خرید بالای 5 متر از پارچه پنبه اکو با 25% تخفیف",
          price: "از 75,000 به 56,250 تومان",
          image: "https://placehold.co/400x200/D1FAE5/000000?text=پنبه+اکو",
          category: "نخی و طبیعی"
        },
        {
          title: "پیشنهاد مخمل کبریتی",
          description: "مخمل کبریتی طرح‌دار با 30% تخفیف فقط امروز",
          price: "از 90,000 به 63,000 تومان",
          image: "https://placehold.co/400x200/FEE2F2/000000?text=مخمل+کبریتی",
          category: "مخملی و کبریتی"
        },
        {
          title: "ساتن مجلسی",
          description: "ساتن براق مجلسی با 15% تخفیف برای خریدهای بالای 3 متر",
          price: "از 85,000 به 72,250 تومان",
          image: "https://placehold.co/400x200/DBEAFE/000000?text=ساتن+مجلسی",
          category: "ابریشمی و براق"
        }
      ],
      discounts: [
        "🎉 تخفیف ویژه: کرپ اکلیلی با 20% تخفیف!",
        "🎊 پیشنهاد محدود: مخمل کبریتی طرح‌دار با 15% تخفیف",
        "🎈 تخفیف آخر هفته: تمام پارچه‌های پشمی 10% ارزان‌تر",
        "🎁 تخفیف بهاری: 15% تخفیف برای پارچه‌های کتان",
        "🌟 پیشنهاد ویژه: 20% تخفیف روی پشم خالص",
        "✨ تخفیف جدید: پارچه لینن با 10% تخفیف!"
      ],
      newFabrics: [
        "✨ پارچه جدید: مخمل کبریتی طرح‌دار",
        "🌟 جدید: کرپ الیزه رنگی",
        "💫 اضافه شد: ژاکارد هندسی مدرن",
        "🆕 پارچه جدید: پوپلین کشی",
        "🔥 تازه رسید: حریر ژرژت طرح‌دار",
        "💎 جدیدترین: پارچه چرم مصنوعی طرح‌دار",
        "🚀 اضافه شد: پارچه دورس خارخورده برای لباس ورزشی"
      ]
    };

    const App = () => {
      const [activeCategory, setActiveCategory] = useState(null);
      const [selectedFabric, setSelectedFabric] = useState(null);
      const [searchQuery, setSearchQuery] = useState("");
      const [searchResults, setSearchResults] = useState([]);
      const [showNotification, setShowNotification] = useState(true);
      const [notificationMessage, setNotificationMessage] = useState("");
      const [showAdvisorModal, setShowAdvisorModal] = useState(false); // State for advisor modal
      const [advisorResponse, setAdvisorResponse] = useState(""); // State for LLM response
      const [loadingAdvisor, setLoadingAdvisor] = useState(false); // State for loading indicator
      const [currentImageIndex, setCurrentImageIndex] = useState(0); // State for image carousel
      const [showSizingChartModal, setShowSizingChartModal] = useState(false); // State for sizing chart modal
      const [isDarkMode, setIsDarkMode] = useState(() => { // Dark mode state
        const savedMode = localStorage.getItem('theme');
        return savedMode === 'dark';
      });

      // Ref for scrolling to fabric details
      const fabricDetailRef = useRef(null);

      // Apply dark mode class to body
      useEffect(() => {
        if (isDarkMode) {
          document.body.classList.add('dark-mode');
        } else {
          document.body.classList.remove('dark-mode');
        }
      }, [isDarkMode]);

      // Set a random notification on component mount
      useEffect(() => {
        const notifications = [
          ...fabricData.discounts,
          ...fabricData.newFabrics
        ];
        const randomNotification = notifications[Math.floor(Math.random() * notifications.length)];
        setNotificationMessage(randomNotification);

        // Check if notification was closed in localStorage
        const lastClosed = localStorage.getItem('notificationClosed');
        if (lastClosed) {
          const now = new Date().getTime();
          const oneDay = 24 * 60 * 60 * 1000;
          if (now - lastClosed < oneDay) {
            setShowNotification(false);
          }
        }
      }, []);

      // Reset image index when selected fabric changes
      useEffect(() => {
        setCurrentImageIndex(0);
      }, [selectedFabric]);

      // Handle search
      useEffect(() => {
        if (searchQuery.trim() === "") {
          setSearchResults([]);
          return;
        }

        const results = [];
        fabricData.categories.forEach(category => {
          category.fabrics.forEach(fabric => {
            if (fabric.name.toLowerCase().includes(searchQuery.toLowerCase())) {
              results.push({
                name: fabric.name,
                category: category.name,
                fabricData: fabric
              });
            }
          });
        });

        setSearchResults(results);
      }, [searchQuery]);

      const handleSearch = (e) => {
        setSearchQuery(e.target.value);
      };

      const handleCloseNotification = () => {
        setShowNotification(false);
        localStorage.setItem('notificationClosed', new Date().getTime());
      };

      const openTelegram = () => {
        // Updated Telegram link
        window.open("https://t.me/Mnntbn", "_blank");
      };

      const handleFabricSelect = (fabric) => {
        setSelectedFabric(fabric);
        // Scroll to the fabric detail section after it's rendered
        setTimeout(() => {
          if (fabricDetailRef.current) {
            fabricDetailRef.current.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }, 100); // Small delay to ensure DOM update
      };

      const handleBackToFabrics = () => {
        setSelectedFabric(null);
      };

      const handleBackToCategories = () => {
        setSelectedFabric(null);
        setActiveCategory(null);
      };

      const handleNextImage = () => {
        if (selectedFabric && selectedFabric.images) {
          setCurrentImageIndex((prevIndex) =>
            (prevIndex + 1) % selectedFabric.images.length
          );
        }
      };

      const handlePrevImage = () => {
        if (selectedFabric && selectedFabric.images) {
          setCurrentImageIndex((prevIndex) =>
            (prevIndex - 1 + selectedFabric.images.length) % selectedFabric.images.length
          );
        }
      };

      // Function to toggle dark mode
      const toggleDarkMode = () => {
        setIsDarkMode(prevMode => {
          const newMode = !prevMode;
          localStorage.setItem('theme', newMode ? 'dark' : 'light');
          return newMode;
        });
      };

      // Function to call Gemini API for styling advice
      const handleGenerateStylingIdea = async () => {
        if (!selectedFabric) return;

        setLoadingAdvisor(true);
        setAdvisorResponse("");
        setShowAdvisorModal(true);

        const prompt = `Based on the following fabric details, suggest creative fashion styling ideas or complementary fabric combinations. Provide a concise and inspiring response in Persian.
        Fabric Name: ${selectedFabric.name}
        Subcategories: ${selectedFabric.subcategories.join(', ')}
        Colors: ${selectedFabric.colors.join(', ')}
        Price: ${selectedFabric.price}
        Discount: ${selectedFabric.discount || 'No discount'}`;

        try {
          let chatHistory = [];
          chatHistory.push({ role: "user", parts: [{ text: prompt }] });
          const payload = { contents: chatHistory };
          const apiKey = ""; // Canvas will automatically provide the API key
          const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

          const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });

          const result = await response.json();
          if (result.candidates && result.candidates.length > 0 &&
              result.candidates[0].content && result.candidates[0].content.parts &&
              result.candidates[0].content.parts.length > 0) {
            const text = result.candidates[0].content.parts[0].text;
            setAdvisorResponse(text);
          } else {
            setAdvisorResponse("متاسفانه نتوانستم ایده‌ای پیدا کنم. لطفاً دوباره تلاش کنید.");
          }
        } catch (error) {
          console.error("Error calling Gemini API:", error);
          setAdvisorResponse("خطا در ارتباط با مشاور هوشمند. لطفاً بعداً تلاش کنید.");
        } finally {
          setLoadingAdvisor(false);
        }
      };

      // Helper to find related fabrics by name
      const getRelatedFabrics = (fabricNames) => {
        const related = [];
        fabricNames.forEach(name => {
          for (const category of fabricData.categories) {
            const foundFabric = category.fabrics.find(f => f.name === name);
            if (foundFabric) {
              related.push(foundFabric);
              break;
            }
          }
        });
        return related;
      };

      return (
        <div className="min-h-screen flex flex-col">
          {/* Header */}
          <header className="bg-white shadow-sm py-4">
            <div className="container mx-auto px-4">
              {/* Header content for both desktop and mobile */}
              <div className="flex justify-between items-center w-full flex-nowrap">
                {/* Title aligned to start (right in RTL) */}
                <h1 className="text-xl md:text-xl font-bold text-teal-800 whitespace-nowrap">تابان جامه</h1>
                {/* Buttons Group aligned to end (left in RTL) */}
                <div className="flex items-center flex-shrink-0 space-x-2 md:space-x-4"> {/* space-x-2 for small gap */}
                  <button
                    onClick={() => setShowSizingChartModal(true)}
                    className="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 md:px-4 md:py-1 rounded-full text-sm font-medium flex items-center whitespace-nowrap header-button"
                  >
                    <i className="fas fa-ruler-horizontal ml-1"></i>
                    <span className="inline md:hidden">سایزبندی</span> {/* Short text for mobile */}
                    <span className="hidden md:inline">جدول سایزبندی</span> {/* Full text for desktop */}
                  </button>
                  <button
                    onClick={openTelegram}
                    className="bg-teal-600 hover:bg-teal-700 text-white px-3 py-1 md:px-4 md:py-1 rounded-full text-sm font-medium flex items-center whitespace-nowrap header-button"
                  >
                    <i className="fas fa-headset ml-1"></i>
                    <span className="inline md:hidden">تماس</span> {/* Short text for mobile */}
                    <span className="hidden md:inline">تماس با ما</span> {/* Full text for desktop */}
                  </button>
                  {/* Dark Mode Toggle Button */}
                  <button
                    onClick={toggleDarkMode}
                    className="bg-gray-200 hover:bg-gray-300 text-gray-800 w-8 h-8 rounded-full flex items-center justify-center text-base"
                    title={isDarkMode ? "حالت روشن" : "حالت تاریک"}
                  >
                    <i className={isDarkMode ? "fas fa-sun" : "fas fa-moon"}></i>
                  </button>
                </div>
              </div>
            </div>
          </header>

          {/* Main Content */}
          <main className="flex-grow container mx-auto px-4 py-6">
            {/* Notification Banner */}
            {showNotification && notificationMessage && (
              <div className="notification-banner bg-teal-600 text-white rounded-lg p-3 mb-6 flex justify-between items-center shadow-md">
                <div className="flex items-center">
                  <i className="fas fa-gift ml-2"></i>
                  <span className="ml-2">{notificationMessage}</span>
                </div>
                <div className="flex items-center">
                  <button
                    onClick={handleCloseNotification}
                    className="text-teal-100 hover:text-white"
                  >
                    <i className="fas fa-times"></i>
                  </button>
                </div>
              </div>
            )}

            {/* Search Bar */}
            <div className="mb-6">
              <div className="relative">
                <input
                  type="text"
                  value={searchQuery}
                  onChange={handleSearch}
                  placeholder="جستجوی پارچه..."
                  className="search-input w-full pr-10 pl-4 py-2 border border-gray-300 rounded-lg focus:border-teal-500"
                />
                <div className="absolute left-3 top-2.5 text-gray-400">
                  <i className="fas fa-search"></i>
                </div>
              </div>
            </div>

            <div className="flex flex-col lg:flex-row gap-6">
              {/* Categories Menu */}
              <div className="w-full lg:w-1/3">
                <div className="bg-white rounded-lg shadow-sm overflow-hidden">
                  <h2 className="text-lg font-bold text-gray-800 p-4 border-b">دسته‌بندی پارچه‌ها</h2>
                  <div className="divide-y divide-gray-200">
                    {fabricData.categories.map((category, index) => (
                      <div key={index}>
                        <div
                          className={`category-item p-3 cursor-pointer ${activeCategory === index ? 'active-category' : ''}`}
                          onClick={() => {
                            setActiveCategory(activeCategory === index ? null : index);
                            setSelectedFabric(null); // Reset selected fabric when category changes
                          }}
                        >
                          <div className="flex justify-between items-center">
                            <span className="font-medium">{category.name}</span>
                            <i className={`fas fa-chevron-${activeCategory === index ? 'up' : 'down'} text-gray-400 text-sm`}></i>
                          </div>
                        </div>
                        {activeCategory === index && (
                          <div className="divide-y divide-gray-200 bg-gray-50">
                            {category.fabrics.map((fabric, fabIndex) => (
                              <div
                                key={fabIndex}
                                className="fabric-item p-3 cursor-pointer pr-6" /* Added pr-6 for indentation */
                                onClick={() => handleFabricSelect(fabric)}
                              >
                                <div className="flex items-center justify-between">
                                  <div className="flex items-center">
                                    <span className="text-teal-500 ml-2">•</span>
                                    <span>{fabric.name}</span>
                                  </div>
                                  {fabric.discount && (
                                    <span className="bg-red-100 text-red-600 text-xs px-2 py-0.5 rounded-full">
                                      تخفیف
                                    </span>
                                  )}
                                </div>
                              </div>
                            ))}
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              {/* Fabrics List / Fabric Detail / Search Results */}
              <div className="w-full lg:w-2/3">
                <div className="bg-white rounded-lg shadow-sm overflow-hidden">
                  {selectedFabric ? (
                    <div className="fabric-detail" ref={fabricDetailRef}> {/* Attach ref here */}
                      <div className="flex justify-between items-center p-4 border-b">
                        <button
                          onClick={handleBackToFabrics}
                          className="text-gray-500 hover:text-gray-700 flex items-center"
                        >
                          <i className="fas fa-arrow-right ml-1"></i>
                          بازگشت
                        </button>
                        <h2 className="text-lg font-bold text-gray-800">
                          {selectedFabric.name}
                        </h2>
                      </div>

                      <div className="p-4">
                        {/* Fabric Image Carousel */}
                        {selectedFabric.images && selectedFabric.images.length > 0 && (
                          <div className="mb-4 relative w-64 h-64 mx-auto group"> {/* Added group for hover effect */}
                            <img
                              src={selectedFabric.images[currentImageIndex]}
                              alt={`تصویر پارچه ${selectedFabric.name} - ${currentImageIndex + 1}`}
                              className="rounded-lg w-full h-full object-cover transition-opacity duration-300" /* Fill the square container, added transition */
                              onError={(e) => { e.target.onerror = null; e.target.src="https://placehold.co/400x300/CCCCCC/000000?text=تصویر+موجود+نیست" }}
                            />
                            {selectedFabric.images.length > 1 && (
                              <>
                                <button
                                  onClick={handlePrevImage}
                                  className="absolute top-1/2 right-2 transform -translate-y-1/2 p-3 bg-white bg-opacity-30 hover:bg-opacity-70 text-gray-800 text-2xl rounded-full z-10 opacity-0 group-hover:opacity-100 transition-all duration-300 scale-90 group-hover:scale-110"
                                >
                                  <i className="fas fa-chevron-right"></i>
                                </button>
                                <button
                                  onClick={handleNextImage}
                                  className="absolute top-1/2 left-2 transform -translate-y-1/2 p-3 bg-white bg-opacity-30 hover:bg-opacity-70 text-gray-800 text-2xl rounded-full z-10 opacity-0 group-hover:opacity-100 transition-all duration-300 scale-90 group-hover:scale-110"
                                >
                                  <i className="fas fa-chevron-left"></i>
                                </button>
                                <div className="absolute bottom-2 w-full flex justify-center gap-2"> {/* Increased gap */}
                                  {selectedFabric.images.map((_, idx) => (
                                    <span
                                      key={idx}
                                      className={`block w-2.5 h-2.5 rounded-full cursor-pointer transition-all duration-300 ${currentImageIndex === idx ? 'bg-white border-2 border-teal-500' : 'bg-gray-400'}`} /* Slightly larger, added border */
                                      onClick={() => setCurrentImageIndex(idx)}
                                    ></span>
                                  ))}
                                </div>
                              </>
                            )}
                          </div>
                        )}

                        {/* Fabric Features */}
                        {selectedFabric.features && selectedFabric.features.length > 0 && (
                          <div className="mb-4 p-3 bg-white rounded-lg"> {/* Changed outer bg to white */}
                            <h3 className="font-medium text-gray-700 mb-2">ویژگی‌ها:</h3>
                            <div className="grid grid-cols-2 gap-2">
                              {selectedFabric.features.map((feature, index) => (
                                <div key={index} className="subcategory-item bg-gray-50 p-2 rounded text-sm"> {/* Used subcategory-item style */}
                                  <i className="fas fa-check-circle text-teal-500 text-xs ml-1"></i>
                                  {feature}
                                </div>
                              ))}
                            </div>
                          </div>
                        )}

                        <div className="mb-4">
                          <h3 className="font-medium text-gray-700 mb-2">زیرمجموعه‌ها:</h3>
                          <div className="grid grid-cols-2 gap-2">
                            {selectedFabric.subcategories.map((subcat, index) => (
                              <div key={index} className="subcategory-item bg-gray-50 p-2 rounded text-sm">
                                <i className="fas fa-circle text-teal-500 text-xs ml-1"></i>
                                {subcat}
                              </div>
                            ))}
                          </div>
                        </div>

                        {/* Width Options */}
                        {selectedFabric.widthOptions && selectedFabric.widthOptions.length > 0 && (
                          <div className="mb-4 p-3 bg-white rounded-lg"> {/* Changed outer bg to white */}
                            <h3 className="font-medium text-gray-700 mb-2">عرض‌های موجود:</h3>
                            <div className="grid grid-cols-2 gap-2"> {/* Changed to grid for consistency */}
                              {selectedFabric.widthOptions.map((option, index) => (
                                <div key={index} className="subcategory-item bg-gray-50 p-2 rounded text-sm"> {/* Used subcategory-item style */}
                                  <i className="fas fa-ruler text-blue-500 text-xs ml-1"></i> {/* Ruler icon */}
                                  {option.width} {option.unit}
                                </div>
                              ))}
                            </div>
                          </div>
                        )}

                        <div className="mb-4">
                          <h3 className="font-medium text-gray-700 mb-2">رنگ‌های موجود:</h3>
                          <div className="flex flex-wrap gap-2">
                            {selectedFabric.colors.map((color, index) => (
                              <div key={index} className="px-3 py-1 bg-gray-100 rounded-full text-xs">
                                {color}
                              </div>
                            ))}
                          </div>
                        </div>

                        <div className="mb-4">
                          <h3 className="font-medium text-gray-700 mb-1">قیمت:</h3>
                          <p className="text-teal-600 font-medium">{selectedFabric.price}</p>
                          {selectedFabric.discount && (
                            <p className="text-red-500 text-sm mt-1">
                              <i className="fas fa-tag ml-1"></i>
                              {selectedFabric.discount}
                            </p>
                          )}
                        </div>

                        <button
                          onClick={openTelegram}
                          className="w-full bg-teal-600 hover:bg-teal-700 text-white py-2 rounded-lg font-medium transition-all mt-4"
                        >
                          <i className="fas fa-shopping-cart ml-1"></i>
                          سفارش این پارچه
                        </button>

                        {/* Gemini API Integration Button */}
                        <button
                          onClick={handleGenerateStylingIdea}
                          className="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg font-medium transition-all mt-2 flex items-center justify-center"
                        >
                          <i className="fas fa-magic ml-2"></i>
                          ✨ مشاور مد هوشمند
                        </button>

                        {/* Related Products */}
                        {selectedFabric.relatedFabrics && selectedFabric.relatedFabrics.length > 0 && (
                          <div className="mt-6 p-3 bg-gray-50 rounded-lg">
                            <h3 className="font-medium text-gray-700 mb-4">پارچه‌های مرتبط:</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                              {getRelatedFabrics(selectedFabric.relatedFabrics).slice(0, 4).map((relatedFab, index) => (
                                <div
                                  key={index}
                                  className="bg-white rounded-lg shadow-sm border border-gray-100 p-3 cursor-pointer hover:shadow-md transition-all duration-200"
                                  onClick={() => handleFabricSelect(relatedFab)}
                                >
                                  <div className="flex items-center">
                                    {relatedFab.images && relatedFab.images.length > 0 && (
                                      <img
                                        src={relatedFab.images[0]}
                                        alt={relatedFab.name}
                                        className="w-16 h-16 object-cover rounded-md ml-3"
                                        onError={(e) => { e.target.onerror = null; e.target.src="https://placehold.co/64x64/CCCCCC/000000?text=N/A" }}
                                      />
                                    )}
                                    <div>
                                      <h4 className="font-medium text-gray-800">{relatedFab.name}</h4>
                                      <p className="text-teal-600 text-sm">{relatedFab.price}</p>
                                    </div>
                                  </div>
                                </div>
                              ))}
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                  ) : searchQuery ? (
                    <>
                      <div className="flex justify-between items-center p-4 border-b">
                        <button
                          onClick={() => setSearchQuery("")}
                          className="text-gray-500 hover:text-gray-700 flex items-center"
                        >
                          <i className="fas fa-arrow-right ml-1"></i>
                          بازگشت
                        </button>
                        <h2 className="text-lg font-bold text-gray-800">نتایج جستجو</h2>
                      </div>

                      {searchResults.length > 0 ? (
                        <>
                          <div className="divide-y divide-gray-200">
                            {searchResults.map((result, index) => (
                              <div
                                key={index}
                                className="fabric-item p-3 cursor-pointer"
                                onClick={() => handleFabricSelect(result.fabricData)}
                              >
                                <div className="flex items-center justify-between">
                                  <div className="flex items-center">
                                    <span className="text-teal-500 ml-2">•</span>
                                    <span>{result.name} <span className="text-gray-500 text-sm">({result.category})</span></span>
                                  </div>
                                  {result.fabricData.discount && (
                                    <span className="bg-red-100 text-red-600 text-xs px-2 py-0.5 rounded-full">
                                      تخفیف
                                    </span>
                                  )}
                                </div>
                              </div>
                            ))}
                          </div>
                        </>
                      ) : (
                        <div className="text-center py-8">
                          <div className="text-gray-500 mb-2">پارچه‌ای یافت نشد</div>
                          <p className="text-gray-400 text-sm">لطفاً عبارت جستجوی خود را تغییر دهید</p>
                        </div>
                      )}
                    </>
                  ) : (
                    <>
                      <div className="text-center py-8 px-4">
                        {/* Logo in Welcome Section */}
                        <img src="https://uploadkon.ir/uploads/2ce828_25photo-2025-05-28-19-57-22-removebg-preview-2-.png" alt="Taban Jameh Logo" className="w-20 h-20 mx-auto mb-4 object-contain" onError={(e) => { e.target.onerror = null; e.target.src="https://placehold.co/60x60/6366F1/FFFFFF?text=Logo" }} />
                        <h2 className="text-xl font-bold text-gray-800 mb-2">به تابان جامه خوش آمدید</h2>
                        <p className="text-gray-500 text-sm max-w-md mx-auto mb-6">
                          برای مشاهده پارچه‌های موجود، لطفاً یک دسته‌بندی را از منوی سمت راست انتخاب کنید.
                        </p>

                        {/* Special Offers Section */}
                        <div className="mt-8">
                          <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center justify-center">
                            <i className="fas fa-percentage text-teal-500 ml-2"></i>
                            پیشنهادات ویژه
                          </h3>
                          {/* Horizontal scroll for mobile, grid for larger screens */}
                          <div className="flex overflow-x-auto lg:grid lg:grid-cols-3 gap-4 pb-4 special-offers-scroll">
                            {fabricData.specialOffers.slice(0, 3).map((offer, index) => (
                              <div key={index} className="special-offer-card-wrapper px-2 lg:px-0"> {/* Wrapper for mobile scroll snapping */}
                                <div className="special-offer-card bg-white rounded-lg border border-gray-100 p-4 w-full max-w-sm mx-auto flex flex-col justify-between h-full"> {/* Added flex-col and justify-between */}
                                  {/* Offer Image */}
                                  {offer.image && (
                                    <div className="mb-3 flex-shrink-0"> {/* Added flex-shrink-0 */}
                                      <img
                                        src={offer.image}
                                        alt={`تصویر پیشنهاد ویژه ${offer.title}`}
                                        className="rounded-md w-full h-32 object-cover"
                                        onError={(e) => { e.target.onerror = null; e.target.src="https://placehold.co/400x200/CCCCCC/000000?text=تصویر+موجود+نیست" }}
                                      />
                                    </div>
                                  )}
                                  <div className="flex-grow flex flex-col"> {/* Added flex-grow */}
                                    <div className="bg-teal-100 text-teal-800 text-xs px-2 py-1 rounded-full inline-block mb-2 self-start"> {/* self-start to align left */}
                                      {offer.category}
                                    </div>
                                    <h4 className="font-bold text-gray-800 mb-1 text-right">{offer.title}</h4> {/* text-right for RTL */}
                                    <p className="text-gray-600 text-sm mb-2 text-right leading-relaxed">{offer.description}</p> {/* text-right for RTL */}
                                  </div>
                                  <div className="flex justify-between items-center flex-shrink-0"> {/* Added flex-shrink-0 */}
                                    <span className="text-teal-600 font-medium">{offer.price}</span>
                                    <button
                                      onClick={openTelegram}
                                      className="text-teal-600 hover:text-teal-700 text-xs"
                                    >
                                      <i className="fas fa-shopping-cart ml-1"></i>
                                      سفارش
                                    </button>
                                  </div>
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>
                      </div>
                    </>
                  )}
                </div>
              </div>
            </div>
          </main>

          {/* Advisor Modal */}
          {showAdvisorModal && (
            <div className="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-lg shadow-xl w-full max-w-md mx-auto p-6">
                <div className="flex justify-between items-center border-b pb-3 mb-4">
                  <h3 className="text-lg font-bold text-gray-800">مشاور مد هوشمند ✨</h3>
                  <button
                    onClick={() => setShowAdvisorModal(false)}
                    className="text-gray-400 hover:text-gray-600"
                  >
                    <i className="fas fa-times"></i>
                  </button>
                </div>
                {loadingAdvisor ? (
                  <div className="flex justify-center items-center py-8">
                    <i className="fas fa-spinner fa-spin text-teal-500 text-3xl"></i>
                    <span className="mr-3 text-gray-600">در حال دریافت ایده...</span>
                  </div>
                ) : (
                  <div className="text-gray-700 leading-relaxed max-h-80 overflow-y-auto">
                    {advisorResponse.split('\n').map((line, index) => (
                      <p key={index} className="mb-2">{line}</p>
                    ))}
                  </div>
                )}
                <div className="mt-6 text-right">
                  <button
                    onClick={() => setShowAdvisorModal(false)}
                    className="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg font-medium"
                  >
                    بستن
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Sizing Chart Modal */}
          {showSizingChartModal && (
            <div className="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-lg shadow-xl w-full max-w-lg mx-auto p-6">
                <div className="flex justify-between items-center border-b pb-3 mb-4">
                  <h3 className="text-lg font-bold text-gray-800">جدول سایزبندی</h3>
                  <button
                    onClick={() => setShowSizingChartModal(false)}
                    className="text-gray-400 hover:text-gray-600"
                  >
                    <i className="fas fa-times"></i>
                  </button>
                </div>
                <div className="overflow-x-auto">
                  <table className="min-w-full bg-white border border-gray-200 rounded-lg">
                    <thead>
                      <tr className="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">
                        <th className="py-3 px-6 text-right">سایز</th>
                        <th className="py-3 px-6 text-right">دور سینه (سانتی‌متر)</th>
                        <th className="py-3 px-6 text-right">دور کمر (سانتی‌متر)</th>
                        <th className="py-3 px-6 text-right">دور باسن (سانتی‌متر)</th>
                      </tr>
                    </thead>
                    <tbody className="text-gray-700 text-sm font-light">
                      <tr className="border-b border-gray-200 hover:bg-gray-50">
                        <td className="py-3 px-6 text-right whitespace-nowrap">S</td>
                        <td className="py-3 px-6 text-right">80-84</td>
                        <td className="py-3 px-6 text-right">64-68</td>
                        <td className="py-3 px-6 text-right">88-92</td>
                      </tr>
                      <tr className="border-b border-gray-200 hover:bg-gray-50">
                        <td className="py-3 px-6 text-right whitespace-nowrap">M</td>
                        <td className="py-3 px-6 text-right">88-92</td>
                        <td className="py-3 px-6 text-right">72-76</td>
                        <td className="py-3 px-6 text-right">96-100</td>
                      </tr>
                      <tr className="border-b border-gray-200 hover:bg-gray-50">
                        <td className="py-3 px-6 text-right whitespace-nowrap">L</td>
                        <td className="py-3 px-6 text-right">96-100</td>
                        <td className="py-3 px-6 text-right">80-84</td>
                        <td className="py-3 px-6 text-right">104-108</td>
                      </tr>
                      <tr className="hover:bg-gray-50">
                        <td className="py-3 px-6 text-right whitespace-nowrap">XL</td>
                        <td className="py-3 px-6 text-right">104-108</td>
                        <td className="py-3 px-6 text-right">88-92</td>
                        <td className="py-3 px-6 text-right">112-116</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <div className="mt-6 text-right">
                  <button
                    onClick={() => setShowSizingChartModal(false)}
                    className="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg font-medium"
                  >
                    بستن
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Footer */}
          <footer className="bg-white border-t py-4">
            <div className="container mx-auto px-4">
              <div className="flex flex-col md:flex-row justify-between items-center text-gray-500 text-sm">
                <p>تمامی حقوق برای تابان جامه محفوظ است © ۱۴۰۴</p>
                <div className="flex items-center mt-2 md:mt-0">
                  <span className="ml-4">شماره تماس: ۰۹۱۱۴۶۸۶۸۹۸</span>
                  <span>آدرس: فومن، جنبه مسجد بالامحله</span>
                </div>
              </div>
            </div>
          </footer>

          {/* Fixed Contact Button */}
          <div className="fixed bottom-6 left-6">
            <button
              onClick={openTelegram}
              className="bg-teal-600 hover:bg-teal-700 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center"
              title="تماس با پشتیبانی"
            >
              <i className="fas fa-headset text-xl"></i>
            </button>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
